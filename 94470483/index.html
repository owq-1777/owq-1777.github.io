<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.owq.world","root":"/","scheme":"Pisces","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"changyan","storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_body":"slideDownIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="从实际应用角度提炼Django模型层的一些知识点, 供快速上手使用ヾ(•ω•&#96;)o">
<meta property="og:type" content="article">
<meta property="og:title" content="Django 模型层">
<meta property="og:url" content="https://www.owq.world/94470483/index.html">
<meta property="og:site_name" content="Sunny was born">
<meta property="og:description" content="从实际应用角度提炼Django模型层的一些知识点, 供快速上手使用ヾ(•ω•&#96;)o">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.owq.world/2022/03/1553-ee0a9f.png">
<meta property="article:published_time" content="2022-03-20T22:00:58.000Z">
<meta property="article:modified_time" content="2022-05-27T07:00:46.534Z">
<meta property="article:author" content="OWQ">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.owq.world/2022/03/1553-ee0a9f.png">

<link rel="canonical" href="https://www.owq.world/94470483/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Django 模型层 | Sunny was born</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Sunny was born" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sunny was born</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<span style="flex-grow: 2;"></span>
<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
      


<div class='bg-container lozad' style="z-index: -1; background-color: #fff;">
  <span class="header-bg"></span>
  <script data-pjax>
    console.info("")
    var header=document.querySelector('.header-bg');
    var img_arr = ["/img/header_img/bg1.webp","/img/header_img/bg2.webp","/img/header_img/bg3.webp","/img/header_img/bg4.webp","/img/header_img/bg5.webp","/img/header_img/bg6.webp"]
    var index = Math.floor((Math.random()*img_arr.length));
    header.setAttribute("style", "background-image: url('"+img_arr[index]+"')");
  </script>
</div>

<div id="signature">
  <div class="container">
        <header class="post-heading">
          <div class="tags">
          </div>
          <h1>Django 模型层</h1>
          <h2 class="subheading">从实际应用角度提炼Django模型层的一些知识点, 供快速上手使用ヾ(•ω•`)o</h2>

          <span class="post-meta-item">
            <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
            </span>
            <span class="post-meta-item-text">Created</span>
            

            <time title="创建时间：2022-03-20 22:00:58" itemprop="dateCreated datePublished" datetime="2022-03-20T22:00:58Z">2022-03-20</time>

            <span style="margin: 0 0.5em;"> | </span>

            <span class="post-meta-item-icon">
              <i class="far fa-calendar-check"></i>
            </span>
            <span class="post-meta-item-text">Updated</span>
              <time title="修改时间：2022-09-22 04:10:12" itemprop="dateModified" datetime="2022-09-22T12:10:12+08:00">2022-09-22</time>
            </span>
            
          </span>




          <span class="post-meta-item">
            <span class="post-meta-item-icon">
              <i class="far fa-file-word"></i>
            </span>
            <span class="post-meta-item-text">Word count:</span>
            <span>8k</span>

            <span style="margin: 0 0.5em;"> | </span>

            <span class="post-meta-item-icon">
              <i class="far fa-clock"></i>
            </span>
            <span class="post-meta-item-text">Reading time: &asymp;</span>
            <span>7 min</span>
          </span>


        </header>

      

  </div>
</div>



<!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main" id="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.owq.world/94470483/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.webp">
      <meta itemprop="name" content="OWQ">
      <meta itemprop="description" content="爱编程, 懂设计, 喜折腾">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunny was born">
    </span>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h2><blockquote>
<p>Django 有丰富了字段类型, 为降低学习成本, 同时也为了维护方便, 尽量使用和数据库一致的数据类型.</p>
</blockquote>
<h3 id="数字类"><a href="#数字类" class="headerlink" title="数字类"></a>数字类</h3><ul>
<li><code>IntegerField</code></li>
<li><code>BigIntField</code></li>
<li><code>FloatField</code></li>
<li><code>DecimalField</code></li>
</ul>
<h3 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h3><ul>
<li><p><code>CharField</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在MySQL中对应的就是varchar, 所以必须指定长度</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">200</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>TextField</code></p>
<p>遇到大的文件或图片时, 将其存放在静态资源服务器, 然后使用URI或者URL存储会更合理.</p>
</li>
</ul>
<h3 id="常用类"><a href="#常用类" class="headerlink" title="常用类"></a>常用类</h3><ul>
<li><p><code>BooleanField</code></p>
</li>
<li><p><code>DateField</code></p>
</li>
<li><p><code>DateTimeField</code></p>
</li>
<li><p><code>AutoField</code></p>
<p>没有指定主键时, 当前模型会自动将一个自增id的<code>IntegerField</code>做为主键.</p>
</li>
<li><p><code>ImageField</code><br>用来做特殊约束和校验的字段, 会校验传入数据是否图片.</p>
</li>
<li><p><code>EmailField</code></p>
<p>用来做特殊约束和校验的字段, 会校验传入数据是否邮箱地址.</p>
</li>
<li><p><code>UUIDField</code><br>一般来说, <code>uuid</code>会用作当前数据表的主键.</p>
</li>
</ul>
<h2 id="字段选项-x2F-约束"><a href="#字段选项-x2F-约束" class="headerlink" title="字段选项&#x2F;约束"></a>字段选项&#x2F;约束</h2><ul>
<li><p><code>primary_key</code><br>如果为<code>True</code>, 将当前字段设置为主键, 默认为<code>False</code>.</p>
</li>
<li><p><code>null</code></p>
<p>如果为<code>True</code>， <code>Django</code>将在数据库中存储空值为 <code>NULL</code>, 默认为 <code>False</code>.</p>
</li>
<li><p><code>blank</code><br>代表空白字符<code>&quot;&quot;</code>, 如果是<code>True</code>, 当前字段允许为空, 默认为<code>False</code></p>
<blockquote>
<p><code>null</code>是数据库上的设置, <code>blank</code>是字段验证上的设置.<br><code>blank</code>设置的字段不可以为<code>NULL</code>.</p>
</blockquote>
</li>
<li><p><code>unique</code><br>唯一约束设置, 默认为<code>False</code></p>
</li>
<li><p><code>default</code><br>设置字段默认值</p>
</li>
<li><p>时间类型</p>
<ul>
<li><p><code>auto_now</code><br>每次保存时更新字段时间为现在, 只有调用<code>Model.seve()</code>时才会生效.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">update_time = models.DateTimeField(auto_now=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>auto_now_add</code><br>第一次创建对象时设置时间.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">create_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong>测试一下</strong></p>
<p>创建应用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python manage.py startapp myblog</span><br></pre></td></tr></table></figure>

<p>添加模板</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line">    email = models.EmailField(null=<span class="literal">True</span>)</span><br><span class="line">    date = models.DateField(auto_now=<span class="literal">True</span>)</span><br><span class="line">    update_time = models.DateTimeField(auto_now=<span class="literal">True</span>)</span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    null_test = models.CharField(max_length=<span class="number">200</span>, null=<span class="literal">True</span>)</span><br><span class="line">    blank_test = models.CharField(max_length=<span class="number">200</span>, blank=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>更新同步</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> makemigrations</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></table></figure>

<p>进入shell, 创建保存一条数据</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> <span class="keyword">shell</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from myblog.models import Person</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; p = Person(name=<span class="string">&#x27;owq&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; p.save()</span></span><br></pre></td></tr></table></figure>

<p>回头看看数据库</p>
<p><img data-src="http://img.owq.world/2022/03/1553-ee0a9f.png"></p>
<h2 id="数据表重构"><a href="#数据表重构" class="headerlink" title="数据表重构"></a>数据表重构</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><blockquote>
<p>执行<code>python manage.py migrate</code>同步失败时</p>
</blockquote>
<ul>
<li>更改<code>migrations</code>中的文件解决问题<ul>
<li>通过调试确认是哪个字段发生错误</li>
</ul>
</li>
</ul>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><blockquote>
<p>数据结构发生改变时</p>
</blockquote>
<ul>
<li>删除<code>migrations</code>文件然后推倒重来<ul>
<li><code>django</code>会在数据表<code>django_migrations</code>中创建同步记录, 需要删除对应的同步记录</li>
<li>删除已经创建记录的表</li>
</ul>
</li>
</ul>
<h2 id="Meta内嵌类"><a href="#Meta内嵌类" class="headerlink" title="Meta内嵌类"></a>Meta内嵌类</h2><blockquote>
<p>通过一个内嵌类Meta来定义元数据.<br>元数据又被称为中介数据, 用来描述数据的数据, 既“所有不是字段的东西”.</p>
</blockquote>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ox</span>(models.Model):</span><br><span class="line">    horn_length = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        ordering = [<span class="string">&quot;horn_length&quot;</span>]</span><br><span class="line">        verbose_name_plural = <span class="string">&quot;oxen&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="字段选项"><a href="#字段选项" class="headerlink" title="字段选项"></a>字段选项</h3><ul>
<li><p><code>abstract</code><br>将当前模型类转换为抽象类, 进行<code>migrate</code>的时候会被忽略, 也就不会对实体表进行修改.</p>
</li>
<li><p><code>app_label</code><br>指定当前<code>model</code>从属于哪个已经注册的应用.<br>一般为应用只编写视图层来处理业务逻辑. 模型层统一由一个<code>models</code>模块来管理<br>比如博客的个人信息<code>models</code>, 很多应用都会使用到, 这时就要使用<code>app_label</code>来区分所属应用了.</p>
</li>
<li><p><code>db_table</code><br>自定义表名, 不指定默认为<code>应用名_模型名</code>, 一般在以下情况使用.</p>
<ul>
<li>目标表已经存在时</li>
<li>没有管理表的权限. 需要dba建表再开发时</li>
<li>规范数据库的表名命名时</li>
</ul>
</li>
<li><p><code>managed</code><br>默认为<code>True</code>, 为<code>False</code>将不会针对当前模型创建和删除数据库表, 也就是会忽略该模型. 一般会在公司有DBA时使用.</p>
</li>
<li><p><code>ordering</code><br>设置排序字段, 默认规则为升序.</p>
<ul>
<li><p>默认升序</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ordering = <span class="string">&#x27;order_date&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-</code>号表示降序</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ordering = [<span class="string">&#x27;-order_date&#x27;</span>]</span><br><span class="line">ordering = [<span class="string">&#x27;-pub_date&#x27;</span>, <span class="string">&#x27;author&#x27;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>?</code>号表示随机</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ordering = [<span class="string">&#x27;?field_name&#x27;</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>get_latest_by</code><br>设置获取最后一条记录的排序规则, 和模型的实例方法<code>latest()</code>相关联</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 升序排序 order_date 字段</span></span><br><span class="line">get_latest_by = <span class="string">&#x27;order_date&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 降序排序 priority, 后升序排序 order_date</span></span><br><span class="line">get_latest_by = [<span class="string">&#x27;-priority&#x27;</span>, <span class="string">&#x27;order_date&#x27;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>indexes</code><br>设置索引, 同样的, 在由DBA的情况下不需要用到.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">    indexes = [</span><br><span class="line">        models.Index(fields=[<span class="string">&#x27;last_name&#x27;</span>, <span class="string">&#x27;first_name&#x27;</span>]),</span><br><span class="line">        models.Index(fields=[<span class="string">&#x27;first_name&#x27;</span>], name=<span class="string">&#x27;first_name_idx&#x27;</span>),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>constraints</code><br>自定义约束</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">    constraints = [</span><br><span class="line">        <span class="comment"># 创建一个检查约束</span></span><br><span class="line">        <span class="comment"># 确保年龄等于18</span></span><br><span class="line">        models.CheckConstraint(check=models.Q(age__gte=<span class="number">18</span>), name=<span class="string">&#x27;age_gte_18&#x27;</span>),</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建一个唯一约束</span></span><br><span class="line">        <span class="comment"># 确保每个房间在每个日期只能被预订一次</span></span><br><span class="line">		UniqueConstraint(field=[<span class="string">&#x27;room&#x27;</span>, <span class="string">&#x27;date&#x27;</span>], name=<span class="string">&#x27;unique_booking&#x27;</span>)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>unique_together</code><br>多字段唯一性约束(未来可能被弃用, 了解下就行)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一组字段名，合起来必须是唯一的</span></span><br><span class="line">unique_together = [<span class="string">&#x27;driver&#x27;</span>, <span class="string">&#x27;restaurant&#x27;</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="模型继承"><a href="#模型继承" class="headerlink" title="模型继承"></a>模型继承</h2><h3 id="直接继承"><a href="#直接继承" class="headerlink" title="直接继承"></a>直接继承</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonInfo</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    age = models.PositiveIntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">CommonInfo</span>):</span><br><span class="line">    home_group = models.CharField(max_length=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h3 id="多重继承"><a href="#多重继承" class="headerlink" title="多重继承"></a>多重继承</h3><blockquote>
<p>默认情况下，Django 给每个模型一个自动递增的主键.<br>如果当前模型对象没有指定主键, 那么两张表主键会产生冲突, 为了解决多重继承产生的id冲突, 需要覆盖主键字段.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(models.Model):</span><br><span class="line">    <span class="comment"># db_column为数据库中的字段</span></span><br><span class="line">    student_id = models.AutoField(primary_key=<span class="literal">True</span>, db_column=<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    book_id = models.AutoField(primary_key=<span class="literal">True</span>, db_column=<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    book_name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BorrowRecord</span>(Student, Book):</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 两张表主键冲突时, 要覆盖主键字段</span></span><br><span class="line">    _<span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>, db_column=<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    borrow_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h2 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h2><ul>
<li><p><code>save()</code><br>将对象保存到数据库(或进行更新操作)</p>
<blockquote>
<p>只会进行数据库操作, 并不会进行字段验证.</p>
</blockquote>
</li>
<li><p><code>clean_fields()</code><br>验证模型上所有字段, 调用<code>save()</code>方法时不会被自动调用.</p>
</li>
<li><p><code>clean()</code><br>自定义模型验证的方法.</p>
</li>
<li><p><code>validate_unique()</code><br>验证模型上所有唯一约束, 和<code>unique_together</code>属性搭配使用.</p>
</li>
<li><p><code>full_clean()</code></p>
<p>依次调用 Model.clean_fields()、 Model.clean() 和 Model.validate_unique()</p>
</li>
<li><p><code>latest()</code><br>获取最后一条记录, 根据<code>get_latest_by</code>属性进行获取.</p>
</li>
<li><p><code>refresh_from_db()</code><br>从数据库里刷新当前记录, 适用于数据库数据发生变动时.</p>
</li>
<li><p><code>__str__()</code><br>用来自定义模型输出.</p>
</li>
</ul>
<h2 id="django-setup"><a href="#django-setup" class="headerlink" title="django.setup()"></a>django.setup()</h2><blockquote>
<p>用来独立运行Django中的应用, 类似于第三方库的使用.<br>比如，编写一个脚本, 然后进行一些ORM操作, 同时也方便我们进行调试.</p>
</blockquote>
<p>这里创建一个测试文件<code>test.py</code>, 使用它来进行调试学习.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_person_data</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        person = Person(</span><br><span class="line">            name=<span class="string">f&#x27;name_<span class="subst">&#123;i&#125;</span>&#x27;</span>,</span><br><span class="line">            email=<span class="string">f&#x27;email_<span class="subst">&#123;i&#125;</span>@163.com&#x27;</span>,</span><br><span class="line">            null_test=<span class="literal">None</span>,</span><br><span class="line">            blank_test=<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 运行字段校验</span></span><br><span class="line">        <span class="comment"># 需要注意这里需要排除 null_test 字段, 忽略 NULL 值的校验</span></span><br><span class="line">        person.clean_fields(exclude=[<span class="string">&#x27;null_test&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        person.save()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置DJANGO_SETTINGS_MODULE环境变量</span></span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;mysite.settings&quot;</span>)</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> myblog.models <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line">    create_person_data()</span><br></pre></td></tr></table></figure>

<h2 id="QuerySet-API"><a href="#QuerySet-API" class="headerlink" title="QuerySet API"></a>QuerySet API</h2><blockquote>
<p><code>QuerySet</code> 本身被构造，过滤，切片，或者复制赋值等操作，是无需访问数据库的。<br>只有在你需要从数据库取出数据或者向数据库存入数据时才需要访问数据库.</p>
</blockquote>
<p>下面用CRUD给这些方法进行分类</p>
<ul>
<li><p><strong>Create</strong></p>
<ul>
<li><code>save()</code></li>
</ul>
</li>
<li><p><strong>Retrieve</strong></p>
<ul>
<li><p><code>all()</code><br>获取表中所有记录.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Model.objects.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>get()</code><br>通过指定条件, 获取<strong>一条</strong>数据, 如果有多条或不存在, 则会报错.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SELECT ... WHERE id = 22;</span></span><br><span class="line">Model.objects.get(<span class="built_in">id</span>=<span class="number">22</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>filter()</code><br>匹配满足条件的记录, 类似于<code>SQL</code>中的<code>WHERE</code>语句.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SELECT ... WHERE name = name_0;</span></span><br><span class="line">Model.objects.<span class="built_in">filter</span>(name=<span class="string">&quot;name_0&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>Django</code>使用<code>__</code>来作为过滤条件标识符, 后面接上关键字来进行查询.</p>
</blockquote>
<p><strong>条件查询</strong></p>
<ul>
<li>gt --- &gt;</li>
<li>get -- &gt;&#x3D;</li>
<li>lt --- &lt;</li>
<li>lte -- &lt;</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SELECT ... WHERE id &gt; 22;</span></span><br><span class="line">Model.objects.<span class="built_in">filter</span>(id__gt=<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SELECT ... WHERE id &lt;= 22;</span></span><br><span class="line">Model.objects.<span class="built_in">filter</span>(id__lte=<span class="number">22</span>)</span><br></pre></td></tr></table></figure>

<p><strong>模糊查询</strong></p>
<ul>
<li>startswith --- 匹配开头</li>
<li>endswith ----- 匹配结尾</li>
<li>icontains ---- 匹配内容</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SELECT ... WHERE name LIKE &#x27;Lennon%&#x27;;</span></span><br><span class="line">Model.objects.<span class="built_in">filter</span>(name__startswith=<span class="string">&#x27;Lennon&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SELECT ... WHERE name LIKE &#x27;%Lennon%&#x27;;</span></span><br><span class="line">Model.objects.<span class="built_in">filter</span>(name__startswith=<span class="string">&#x27;%Lennon%&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>exclude()</code><br>匹配不匹配对象, 与<code>filter()</code>逻辑相反.</p>
</li>
<li><p><code>latest()</code></p>
<p>返回最后一条数据.</p>
</li>
<li><p><code>order_by()</code></p>
<p>设置排序, 可以覆盖<code>ordering</code>选项</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这里需要注意, 排序并不涉及数据库操作, 是在本地进行的</span></span><br><span class="line">Model.objects.<span class="built_in">all</span>().order_by(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;id&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>Update</strong></p>
<ul>
<li><code>save()</code></li>
</ul>
</li>
<li><p><strong>Delete</strong></p>
<ul>
<li><p><code>delete()</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除id大于</span></span><br><span class="line">Model.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>&gt;=<span class="number">22</span>).delete()</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h2><h3 id="原始SQL"><a href="#原始SQL" class="headerlink" title="原始SQL"></a>原始SQL</h3><blockquote>
<p>遇到复杂的场景, 使用<code>raw()</code>来执行<code>SQL</code>语句.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Reader._meta.db_table -- 记录所在表名</span></span><br><span class="line">Mode.objects.raw(<span class="string">f&quot;select * from <span class="subst">&#123;Reader._meta.db_table&#125;</span> limit 1&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="多个数据库"><a href="#多个数据库" class="headerlink" title="多个数据库"></a>多个数据库</h3><p>修改<code>mysite/settings.py</code>添加数据库配置.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;polls&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;person&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;person&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>using</code> 参数指定数据库.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">person.save(using=<span class="string">&#x27;person&#x27;</span>)</span><br><span class="line">Person.objects.using(<span class="string">&#x27;person&#x27;</span>).<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>使用<code>transaction.atomic()</code>控制数据库事务</p>
<ul>
<li><p>基于HTTP请求的事务</p>
<ul>
<li>在<code>settings</code>中要设置<code>ATOMIC_REQUESTS</code>为<code>True</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="meta">@transaction.atomic</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">viewfunc</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 在事务中执行的代码</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>基于视图具体逻辑的事务</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> transaction</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">viewfunc</span>(<span class="params">request</span>):</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">with</span> transaction.atomic():</span><br><span class="line">		<span class="comment"># 在事务中执行的代码</span></span><br><span class="line">		...</span><br></pre></td></tr></table></figure></li>
</ul>
<p>注意，只有视图被限制在事务中执行。中间件在事务之外运行，同理，渲染模板响应也是在事务之外运行的。</p>
<p><strong>参考文档📕</strong></p>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL3poLWhhbnMvMy4yL3RvcGljcy9kYi9tb2RlbHMv">模型 | Django 文档 | Django (djangoproject.com)</span><br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL3poLWhhbnMvMy4yL3JlZi9tb2RlbHMvZmllbGRzLw==">模型字段参考 | Django 文档 | Django (djangoproject.com)</span><br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL3poLWhhbnMvMy4yL3JlZi9tb2RlbHMvb3B0aW9ucy8=">模型 Meta 选项 | Django 文档 | Django (djangoproject.com)</span><br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL3poLWhhbnMvMy4yL3JlZi9tb2RlbHMvY29uc3RyYWludHMv">约束参考 | Django 文档 | Django (djangoproject.com)</span><br><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL3poLWhhbnMvMy4yL3RvcGljcy9zZXR0aW5ncy8=">Django 配置 | Django 文档 | Django (djangoproject.com)</span></p>
</blockquote>

    </div>

    
      <div class='post_end_tag'>
        
    <span>------------ 已触及底线了 <i class="fa fa-archive fa-paw"></i> 感谢您的阅读 ------------</span>

      </div>
    

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>OWQ
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.owq.world/94470483/" title="Django 模型层">https://www.owq.world/94470483/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处（￣︶￣）↗
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
              <a href="/tags/Django/" rel="tag"><i class="fa fa-tag"></i> Django</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/80aa4d4c/" rel="prev" title="Django 视图层">
      <i class="fa fa-chevron-left"></i> Django 视图层
    </a></div>
      <div class="post-nav-item">
    <a href="/34b94b2a/" rel="next" title="说说 python 中单例模式的实现">
      说说 python 中单例模式的实现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          目录
        </li>
        <li class="sidebar-nav-overview">
          概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="nav-text">字段类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E7%B1%BB"><span class="nav-text">数字类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB"><span class="nav-text">字符类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%B1%BB"><span class="nav-text">常用类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E9%80%89%E9%A1%B9-x2F-%E7%BA%A6%E6%9D%9F"><span class="nav-text">字段选项&#x2F;约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E9%87%8D%E6%9E%84"><span class="nav-text">数据表重构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-text">方法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Meta%E5%86%85%E5%B5%8C%E7%B1%BB"><span class="nav-text">Meta内嵌类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E9%80%89%E9%A1%B9"><span class="nav-text">字段选项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E7%BB%A7%E6%89%BF"><span class="nav-text">模型继承</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E7%BB%A7%E6%89%BF"><span class="nav-text">直接继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="nav-text">多重继承</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-text">实例方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#django-setup"><span class="nav-text">django.setup()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#QuerySet-API"><span class="nav-text">QuerySet API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7"><span class="nav-text">高级</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8BSQL"><span class="nav-text">原始SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">多个数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-text">事务</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="OWQ"
      src="/images/avatar.webp">
  <p class="site-author-name" itemprop="name">OWQ</p>
  <div class="site-description" itemprop="description">爱编程, 懂设计, 喜折腾</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">40</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnF3cWlvd29Ab3V0bG9vay5jb20=" title="E-Mail → mailto:qwqiowo@outlook.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fas fa-rss fa-fw"></i>RSS</a>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL293cS0xNzc3" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;owq-1777"><i class="fab fa-github-alt" fa-fw"></i>GitHub</span>
      </span>
  </div>


<!-- hitokoto -->
<strong>
<div id="hitokoto_wrap">
    <div id="hitokoto_text">&nbsp;&nbsp;&nbsp;&nbsp;抬头望天，低头走路。</div>
    <div id="hitokoto_from">——无名</div>
</div>
</strong>

<script>
    let hitokoto_wrap = document.getElementById("hitokoto_wrap");
    let hitokoto_text = document.getElementById('hitokoto_text')
    let hitokoto_from = document.getElementById('hitokoto_from');
    async function loadHitokoto(){
        // Fetch API
        // 调用一言接口 根据需求配置
        // fetch('https://v1.hitokoto.cn?min_length=12')
        fetch('https://international.v1.hitokoto.cn?min_length=12')
        .then(response => response.json())
        .then(data => {
            hitokoto_text.innerText = '\xa0\xa0\xa0\xa0\xa0\xa0\xa0' + data.hitokoto;
            hitokoto_from.innerText = "——" + data.from + '\xa0';
        })
        .catch(console.error)
    }
    loadHitokoto();

    hitokoto_wrap.addEventListener("click", async function(e){
        loadHitokoto();
        // 去除字符串前后空格
        let content = (hitokoto_text.innerText + hitokoto_from.innerText).trim()
        // Clipboard API
        // 复制一言内容到剪贴板
        navigator.clipboard.writeText(content)
        .then(console.log(content))
        .catch(console.error)
    });
</script>
<script>
    // 鼠标点击爱心
    !function(e, t, a) {
        function r() {
            for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
            requestAnimationFrame(r)
        }
        function n() {
            var t = "function" == typeof e.onclick && e.onclick;
            hitokoto_wrap.addEventListener("click", function(e) {
                t && t(),
                    o(e)
            });
        }
        function c() {
            return "rgb(" + ~~ (255 * Math.random()) + "," + ~~ (255 * Math.random()) + "," + ~~ (255 * Math.random()) + ")"
        }
        function o(e) {
            var a = t.createElement("div");
            a.className = "heart",
                s.push({
                    el: a,
                    x: e.clientX - 5,
                    y: e.clientY - 5,
                    scale: 1,
                    alpha: 1,
                    color: c()
                }),
                t.body.appendChild(a)
        }
        function i(e) {
            var a = t.createElement("style");
            a.type = "text/css";
            try {
                a.appendChild(t.createTextNode(e))
            } catch(t) {
                a.styleSheet.cssText = e
            }
            t.getElementsByTagName("head")[0].appendChild(a)
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame ||
            function(e) {
                setTimeout(e, 1e3 / 60)
            },
            i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),
            n(),
            r()
    } (window, document);
</script>
      </div>

      <hr class="hr-solid">
    </div>


  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">粤ICP备2021144316号 </span>
      <img src="/images/gongan.png" style="display: inline-block;"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5nb3YuY24vcG9ydGFsL3JlZ2lzdGVyU3lzdGVtSW5mbz9yZWNvcmRjb2RlPTQ0MDMwNTAyMDA4Mzk2">粤公网安备 44030502008396号 </span>
  </div>

<div class="copyright">
  <span id="RunTime"></span>
  <!-- 网站运行时间的设置 -->
  <script>
    var BootDate = new Date("2021/08/01 00:00:00");
    function ShowRunTime(id) {
      var NowDate = new Date();
      var RunDateM = parseInt(NowDate - BootDate);
      var RunDays = Math.floor(RunDateM/(24*3600*1000));
      var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
      var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
      var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
      var RunTime = RunDays + " d " + RunHours + " h " + RunMinutes + " m " + RunSeconds + " s ";
      document.getElementById(id).innerHTML = "This blog has running: " + RunTime;
    }
    setInterval("ShowRunTime('RunTime')", 1000);
  </script>
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">OWQ</span>

<div class="busuanzi-count">

  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">123k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:52</span>
</div>

</div>
  <script src="/js/ribbonDynamic.js"></script>
        






      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.bg-container',
    '#signature .container',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>











<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '472553d47287225fff92',
      clientSecret: 'a2e30c338a55dfc350329833114d277bcfa79a6e',
      repo        : 'owq-1777.github.io',
      owner       : 'owq-1777',
      admin       : ['owq-1777'],
      id          : '5e0639845c1a2c0409b2ca080f0c8097',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"life","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.9},"log":false});</script></body>
</html>

<script type="text/javascript" src="/js/src/funny_title.js"></script>